<div class="container py-4">
  <h2 class="mb-3">Bảng Tin</h2>

  <!-- Form đăng bài viết -->
  <form action="/posts" method="POST" enctype="multipart/form-data" class="card mb-4 p-3">
    <div class="mb-3">
      <textarea name="content" class="form-control" placeholder="Bạn đang nghĩ gì?" rows="3" required></textarea>
    </div>
    <div class="mb-3">
      <label for="imageUpload" class="btn btn-outline-primary">
        <i class="bi bi-image"></i> Chọn ảnh
      </label>
      <input type="file" name="image" id="imageUpload" class="d-none">
      <span id="selectedFileName" class="ms-2 text-muted"></span>
      <div id="imagePreview" class="mt-2"></div>
    </div>
    <div class="text-end">
      <button type="submit" class="btn btn-primary">Đăng bài</button>
    </div>
  </form>

  <!-- Danh sách bài viết -->
  {{#each posts}}
    <div class="card mb-3 shadow-sm" data-post-id="{{this._id}}" data-user-id="{{this.author._id}}" id="post_{{this._id}}">
      <div class="card-body">
        <!-- Header -->
        <div class="d-flex align-items-center mb-2">
          <a href="/users/{{this.author._id}}" class="user-link" data-user-id="{{author._id}}">
            <img src="{{#if this.author.avatarUrl}}{{this.author.avatarUrl}}{{else}}/images/default-avatar.png{{/if}}" alt="avatar" class="rounded-circle me-2" width="40" height="40">
          </a>
          <div>
            <a href="/users/{{this.author._id}}" class="user-link text-dark text-decoration-none" data-user-id="{{author._id}}">
              <div class="fw-bold">{{this.author.username}}</div>
            </a>
            <small class="text-muted">{{formatTimeAgo this.createdAt}}</small>
          </div>
        </div>

        <!-- Content -->
        <p class="mb-2" style="white-space: pre-wrap;">{{this.content}}</p>

        <!-- Image -->
        {{#if this.imageUrl}}
          <img src="{{this.imageUrl}}" class="img-fluid rounded d-block mx-auto my-2" style="max-height: 400px;">
        {{/if}}

        <!-- Reactions -->
        <div class="d-flex justify-content-between align-items-center mt-3">
          {{#if (includes this.likes ../user._id)}}
            <button class="btn btn-sm btn-primary text-white btn-like">
          {{else}}
            <button class="btn btn-sm btn-outline-primary btn-like">
          {{/if}}
              <i class="bi bi-hand-thumbs-up me-1"></i>
              <span class="like-count">{{this.likes.length}}</span> Thích
            </button>
        </div>

        <!-- Comments -->
        <ul class="mt-3 comment-list list-unstyled">
          {{#each this.comments}}
            <li data-comment-id="{{this._id}}" class="mt-1">
              <a href="/users/{{this.author._id}}" class="user-link" data-user-id="{{this.author._id}}">
                <img src="{{#if this.author.avatarUrl}}{{this.author.avatarUrl}}{{else}}/images/default-avatar.png{{/if}}" alt="avatar" class="rounded-circle me-2" width="30" height="30">
              </a>
              <a href="/users/{{this.author._id}}" class="user-link text-dark text-decoration-none" data-user-id="{{this.author._id}}">
                <strong>{{this.author.username}}:</strong> {{this.content}}
              </a>
              {{#ifCond  ../this.author._id ../../user._id this.author._id}}
                <button class="btn btn-sm btn-link text-danger p-0 ms-2 btn-delete-comment"
                        data-comment-id="{{this._id}}" data-post-id="{{../_id}}">X</button>
              {{/ifCond}}
            </li>
          {{/each}}
        </ul>

        <!-- Form comment -->
        <form class="mt-2 comment-form d-flex">
          <input type="text" class="form-control me-2 comment-input" placeholder="Viết bình luận...">
          <button type="submit" class="btn btn-primary btn-sm">Gửi</button>
        </form>
      </div>
    </div>
  {{/each}}
</div>